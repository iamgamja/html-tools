<!DOCTYPE HTML>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--     한영타, 영한타 -->
    <script src="e2k-k2e.js"></script>
<!--     md5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
<!--     brython -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.8.8/brython.js" integrity="sha256-rA89wPrTJJQFWJaZveKW8jpdmC3t5F9rRkPyBjz8G04=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.8.8/brython_stdlib.js" integrity="sha256-Gnrw9tIjrsXcZSCh/wos5Jrpn0bNVNFJuNJI9d71TDs=" crossorigin="anonymous"></script>
<!--     math.js -->
    <script src="https://unpkg.com/mathjs@9.3.0/lib/browser/math.js"></script>
    
    <script>      
      function body_load() {
        table = document.getElementById("table");
        table_html = ""
        table_items = ["기본값", "글자수", "한영타", "영한타", "영한영타", "한영한타", "반대로", "첫번째글자", "마지막글자", "계산값"]
        for (i of table_items) {
          table_html += `<tr><td>${i}</td><td id="${i}"></td><td id="${i}_"></td></tr>`
        }
        table.innerHTML = table_html
      }
      
      function set(id, value) {
        return localStorage.setItem(id, JSON.stringify(value))
      }
      function get(id) {
        return JSON.parse(localStorage.getItem(id))
      }
      
      special_md5 = get("special_md5")
      if (!special_md5) {
        special_md5 = {
          "2": {},
          "3": {},
          "4": {},
          "5": {},
          "6": {},
          "7": {},
          "8": {},
          "9": {},
          "10": {},
          "11": {},
          "12": {},
          "13": {},
          "14": {},
          "15": {},
          "16": {}
        } // 
      }
      
      function md5(m) {
        m = m.toString()
        f = CryptoJS.MD5(m).toString()
        
        for (i=2; i<=16; i++) {
          if (!(f.startsWith(f[0].repeat(i)))) {
            break
          }
        }
        same_number = i-1
        if (same_number !== 1) { // 앞자리 일부가 겹칠때만
          if (!(m in special_md5[same_number.toString()])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다${"!".toString().repeat(same_number)} \n${m}: \n${f}`, "background:lime;color:green;"); // 알려주고
            special_md5[same_number.toString()][m] = f; // json에 추가
            set("special_md5", special_md5); // 저장
          }
        }
        return f
      }

      function chr(n) {
        return String.fromCharCode(n)
      }
      function ord(s) {
        return s.charCodeAt(0)
      }

      function set_table(table_id, value) {
        document.getElementById(table_id).innerHTML = '<pre>' + value + '</pre>';
        document.getElementById(table_id+'_').innerHTML = '<pre>' + md5(value) + '</pre>';
      }

      shift = false;
      function shift_check() {
        if (event.keyCode == 16) { // 쉬프트 눌림
          if (shift === true) { // 연속 2번 눌렸다면
            // 조금 위험한 것들 실행(계산)
            try {
              set_table("계산값", math.evaluate(m));
            } catch(e) {
              set_table("계산값", e);
            }

            shift = false;
          } else {
            shift = true;
          }
        } else {
          shift = false;
        }
      }

      function click_table() {
        var s = event.target.innerHTML;
        if (s.startsWith("<pre>") && s.endsWith("</pre>")) {
          s = s.slice(5, -6)
        }
        document.getElementById("myTextarea").value = s
        main();
      }

      function main() {
        m = document.getElementById("myTextarea").value;

        set_table("기본값", m);
        set_table("글자수", m.length !== 0 ? m.length : "");
        set_table("한영타", gksdud(m));
        set_table("영한타", dudgks(m));
        set_table("영한영타", gksdud(dudgks(m)));
        set_table("한영한타", dudgks(gksdud(m)));
        set_table("반대로", m.split("").reverse().join(""));
        set_table("첫번째글자", m[0] !== undefined ? m[0] : "");
        set_table("마지막글자", m.slice(-1));
      }
    </script>
  </head>
  
  <body id="body" onkeydown="shift_check();" onload="body_load();">
    <form>
      <textarea id="myTextarea" autofocus placeholder="입력해보세요!" oninput="main();"></textarea><br>
    </form>
    <table id="table" border="1" onclick="click_table(event);"> </table>
  </body>
</html>
