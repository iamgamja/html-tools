<!DOCTYPE HTML>
<html lang="ko">
  <head>
    <style>
      td {
        cursor: pointer;
      }
      table {
        font-family: monospace;
        white-space: pre-line;
        word-break: break-all;
      }
      .custom-menu {
        z-index: 100;
        position: absolute;
        background-color: orange;
        border: 2px solid white;
        padding: 2px;
        font-family: monospace;
      }
    </style> 버전:2021-03-29 12:56 15.00
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--     한영타, 영한타 -->
    <script src="e2k-k2e.js"></script>
<!--     md5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
<!--     SHA256 -->
    <script src="SHA256.js"></script>
<!--     brython -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.8.8/brython.js" integrity="sha256-rA89wPrTJJQFWJaZveKW8jpdmC3t5F9rRkPyBjz8G04=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.8.8/brython_stdlib.js" integrity="sha256-Gnrw9tIjrsXcZSCh/wos5Jrpn0bNVNFJuNJI9d71TDs=" crossorigin="anonymous"></script>
<!--     math.js -->
    <script src="https://unpkg.com/mathjs@9.3.0/lib/browser/math.js"></script>
<!--     제이쿼리 -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    
    <script>      
      function body_load() {
        table = document.getElementById("table");
        
        window.onresize = function() {
          table.style.width = `${body.offsetWidth}px`
        }
        
        table_html = ""
        table_items = ["기본값", "글자수", "한영타", "영한타", "영한영", "한영한", "반대로", "첫번째", "마지막", "계산값"]
        for (i of table_items) {
          table_html += `<tr><td id="${i}${i}" onclick="click_table();">${i}</td><td id="${i}" onclick="click_table();"></td><td id="${i}_" onmouseenter="see_spoiler();" onclick="click_table();"></td><td id="${i}__" onmouseenter="see_spoiler();" onclick="click_table();"></td></tr>`
        }
        table.innerHTML = table_html
        
        document.getElementById("기본값기본값").style.width = "42px";
        document.getElementById("기본값_").style.width = "49px"; // 224
        document.getElementById("기본값__").style.width = "49px"; // 448
        
        main();
        
        console.log("전부 로드되었습니다.")
      }
      
      $(document).bind("contextmenu", function(event) { 
        event.preventDefault();
        $(`<div class='custom-menu'>${event.target.innerHTML || event.target.nodeValue || "None"}</div>`)
          .appendTo("#contentMenuDiv")
          .css({top: (event.pageY) + "px", left: (event.pageX + "px")});
      }).bind("click", function(event) {
        $("contentMenuDiv").empty();
      });
      
      function set(id, value) {
        return localStorage.setItem(id, JSON.stringify(value))
      }
      function get(id) {
        return JSON.parse(localStorage.getItem(id))
      }
      function reset_specials() {
        set("special_md5", false);
        set("special_sha256", false);
        location.reload();
      }
      
      special_md5 = get("special_md5")
      if (!special_md5) {
        special_md5 = {}
        for (i=3; i<=16; i++) {
          special_md5[i.toString()] = {}
        }
        special_md5["mirror"] = {}
        set("special_md5", special_md5)
      }
      
      special_sha256 = get("special_sha256")
      if (!special_sha256) {
        special_sha256 = {}
        for (i=3; i<=64; i++) {
          special_sha256[i.toString()] = {}
        }
        special_sha256["mirror"] = {}
        set("special_sha256", special_sha256)
      }
      
      function md5(m) {
        m = m.toString()
        f = CryptoJS.MD5(m).toString()
        
        for (i=2; i<=16; i++) {
          if (!(f.startsWith(f[0].repeat(i)))) {
            break
          }
        }
        same_number = i-1
        if (same_number > 3) { // 앞자리 일부가 겹치면
          if (!(m in special_md5[same_number.toString()])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (md5 앞 ${same_number}자리가 겹침) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_md5[same_number.toString()][m] = f; // json에 추가
            set("special_md5", special_md5); // 저장
          }
        } else if (f.split("").reverse().join("") === f) { // 뒤집어도 같다면
          if (!(m in special_md5["mirror"])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (md5 뒤집어도 같음) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_md5["mirror"][m] = f; // json에 추가
            set("special_md5", special_md5); // 저장
          }
        }
        return f
      }
      
      function sha256(m) {
        m = m.toString()
        f = SHA256(m)
        
        for (i=2; i<=64; i++) {
          if (!(f.startsWith(f[0].repeat(i)))) {
            break
          }
        }
        same_number = i-1
        if (same_number > 3) { // 앞자리 일부가 겹치면
          if (!(m in special_sha256[same_number.toString()])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (sha256 앞 ${same_number}자리가 겹침) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_sha256[same_number.toString()][m] = f; // json에 추가
            set("special_sha256", special_sha256); // 저장
          }
        } else if (f.split("").reverse().join("") === f) { // 뒤집어도 같다면
          if (!(m in special_sha256["mirror"])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (sha256 뒤집어도 같음) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_sha256["mirror"][m] = f; // json에 추가
            set("special_sha256", special_sha256); // 저장
          }
        }
        return f
      }

      function chr(n) {
        return String.fromCharCode(n)
      }
      function ord(s) {
        return s.charCodeAt(0)
      }

      function set_table(table_id, value) {
        document.getElementById(table_id).innerHTML = value;
        document.getElementById(table_id+'_').innerHTML = `<!--${md5(value)}-->${md5(value).slice(0, 2)}...${md5(value).slice(-2)}`;
        document.getElementById(table_id+'__').innerHTML = `<!--${sha256(value)}-->${sha256(value).slice(0, 2)}...${sha256(value).slice(-2)}`;
      }

      shift = false;
      function shift_check() {
        if (event.keyCode == 16) { // 쉬프트 눌림
          if (shift === true) { // 연속 2번 눌렸다면
            // 조금 위험한 것들 실행(계산)
            try {
              set_table("계산값", math.evaluate(m));
            } catch(e) {
              set_table("계산값", e);
            }

            shift = false;
          } else {
            shift = true;
          }
        } else {
          shift = false;
        }
      }
      
      function get_c1(ele) {
        return ele.childNodes[0].nodeValue // 주석 내용
      }
      function get_c2(ele) {
        return ele.childNodes[1].nodeValue // 주석을 제외한 모든 내용
      }
      
      function click_table() {
        if (!event.target.id.endsWith("_")) {
          document.getElementById("myTextarea").value = event.target.innerHTML;
        } else {
          c1 = get_c1(event.target)
          c2 = get_c2(event.target)
          document.getElementById("myTextarea").value = c1.length > c2.length ? c1 : c2 // 더 긴(원래 hash) 값을 넣는다
        }
        main();
      }
      
      function set_see_spoiler(ele) {
        c1 = get_c1(ele)
        c2 = get_c2(ele)
        if (c1.length < c2.length) return; // 이미 보인다면 리턴
        ele.innerHTML = `<!--${c2}-->${c1}`
      }
      function set_not_see_spoiler(ele) {
        c1 = get_c1(ele)
        c2 = get_c2(ele)
        if (c1.length > c2.length) return; // 이미 안보인다면 리턴
        ele.innerHTML = `<!--${c2}-->${c1}`
      }
      
      function see_spoiler() {
        set_see_spoiler(event.currentTarget);
        trs = document.getElementById("table").childNodes[0].childNodes; // tr 여러개
        for (tr of trs) {
          tds = tr.childNodes; // td 2개
          for (td of tds) {
            if (td.id.endsWith("_") && td !== event.currentTarget) {
              set_not_see_spoiler(td);
            }
          }
        }
        if (!event.currentTarget.id.endsWith("__")) { // md5
          document.getElementById("기본값_").style.width = "224px";
          document.getElementById("기본값__").style.width = "49px";
        } else { // sha256
          document.getElementById("기본값__").style.width = "448px";
          document.getElementById("기본값_").style.width = "49px";
        }
      }
      
      function all_spoiler() {
        trs = document.getElementById("table").childNodes[0].childNodes; // tr 여러개
        for (tr of trs) {
          tds = tr.childNodes; // td 2개
          for (td of tds) {
            if (td.id.endsWith("_")) {
              set_not_see_spoiler(td);
            }
          }
        }
        document.getElementById("기본값_").style.width = "49px";
        document.getElementById("기본값__").style.width = "49px";
      }

      function main() {
        m = document.getElementById("myTextarea").value || "";

        set_table("기본값", m);
        set_table("글자수", m.length || "");
        set_table("한영타", gksdud(m));
        set_table("영한타", dudgks(m));
        set_table("영한영", gksdud(dudgks(m)));
        set_table("한영한", dudgks(gksdud(m)));
        set_table("반대로", m.split("").reverse().join(""));
        set_table("첫번째", m[0] || "");
        set_table("마지막", m.slice(-1));
        set_table("계산값", "");
      }
    </script>
  </head>
  
  <body id="body" onkeydown="shift_check();" onload="body_load();">
    <form>
      <textarea id="myTextarea" autofocus placeholder="입력해보세요!" oninput="main();"></textarea><br>
    </form>
    <table id="table" border="1" onmouseleave="all_spoiler();"> </table>
    <br><br><br>
    <div id="contentMenuDiv"></div>
  </body>
</html>
