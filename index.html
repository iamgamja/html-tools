<!DOCTYPE HTML>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--     한영타, 영한타 -->
    <script src="e2k-k2e.js"></script>
<!--     md5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
<!--     SHA256 -->
    <script src="SHA256.js"></script>
<!--     brython -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.8.8/brython.js" integrity="sha256-rA89wPrTJJQFWJaZveKW8jpdmC3t5F9rRkPyBjz8G04=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.8.8/brython_stdlib.js" integrity="sha256-Gnrw9tIjrsXcZSCh/wos5Jrpn0bNVNFJuNJI9d71TDs=" crossorigin="anonymous"></script>
<!--     math.js -->
    <script src="https://unpkg.com/mathjs@9.3.0/lib/browser/math.js"></script>
    
    <script>      
      function body_load() {
        table = document.getElementById("table");
        table_html = ""
        table_items = ["기본값", "글자수", "한영타", "영한타", "영한영타", "한영한타", "반대로", "첫번째글자", "마지막글자", "계산값"]
        for (i of table_items) {
          table_html += `<tr><td>${i}</td><td id="${i}"></td><td id="${i}_" onmouseover="see_spoiler();" onmouseout="not_see_spoiler();"></td><td id="${i}__" onmouseover="see_spoiler();" onmouseout="not_see_spoiler();"></td></tr>`
        }
        table.innerHTML = table_html
      }
      
      function set(id, value) {
        return localStorage.setItem(id, JSON.stringify(value))
      }
      function get(id) {
        return JSON.parse(localStorage.getItem(id))
      }
      function reset_specials() {
        set("special_md5", false);
        set("special_sha256", false);
        location.reload();
      }
      
      special_md5 = get("special_md5")
      if (!special_md5) {
        special_md5 = {}
        for (i=3; i<=16; i++) {
          special_md5[i.toString()] = {}
        }
        special_md5["mirror"] = {}
        set("special_md5", special_md5)
      }
      
      special_sha256 = get("special_sha256")
      if (!special_sha256) {
        special_sha256 = {}
        for (i=3; i<=64; i++) {
          special_sha256[i.toString()] = {}
        }
        special_sha256["mirror"] = {}
        set("special_sha256", special_sha256)
      }
      
      function md5(m) {
        m = m.toString()
        f = CryptoJS.MD5(m).toString()
        
        for (i=2; i<=16; i++) {
          if (!(f.startsWith(f[0].repeat(i)))) {
            break
          }
        }
        same_number = i-1
        if (same_number > 3) { // 앞자리 일부가 겹치면
          if (!(m in special_md5[same_number.toString()])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (앞 ${same_number}자리가 겹침) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_md5[same_number.toString()][m] = f; // json에 추가
            set("special_md5", special_md5); // 저장
          }
        } else if (f.split("").reverse().join("") === f) { // 뒤집어도 같다면
          if (!(m in special_md5["mirror"])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (뒤집어도 같음) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_md5["mirror"][m] = f; // json에 추가
            set("special_md5", special_md5); // 저장
          }
        }
        return f
      }
      
      function sha256(m) {
        m = m.toString()
        f = SHA256(m)
        
        for (i=2; i<=64; i++) {
          if (!(f.startsWith(f[0].repeat(i)))) {
            break
          }
        }
        same_number = i-1
        if (same_number > 3) { // 앞자리 일부가 겹치면
          if (!(m in special_sha256[same_number.toString()])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (sha256 앞 ${same_number}자리가 겹침) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_sha256[same_number.toString()][m] = f; // json에 추가
            set("special_sha256", special_sha256); // 저장
          }
        } else if (f.split("").reverse().join("") === f) { // 뒤집어도 같다면
          if (!(m in special_sha256["mirror"])) { // 새로운 문자라면
            console.log(`%c새로운 문자를 발견했습니다! (sha256 뒤집어도 같음) %c\n${m} => \n${f}`, "background:lime;color:green;", "background:white;color:black;"); // 알려주고
            special_sha256["mirror"][m] = f; // json에 추가
            set("special_sha256", special_sha256); // 저장
          }
        }
        return f
      }

      function chr(n) {
        return String.fromCharCode(n)
      }
      function ord(s) {
        return s.charCodeAt(0)
      }

      function set_table(table_id, value) {
        document.getElementById(table_id).innerHTML = `<pre>${value}</pre>`;
//         document.getElementById(table_id+'_').innerHTML = `<pre>${md5(value)}</pre>`;
//         document.getElementById(table_id+'__').innerHTML = `<pre>${sha256(value)}</pre>`;
        document.getElementById(table_id+'_').innerHTML = `<!-- ${md5(value)} --><pre>${md5(value).slice(0, 2)}...${md5(value).slice(-2)}</pre>`;
        document.getElementById(table_id+'__').innerHTML = `<!-- ${sha256(value)} --><pre>${sha256(value).slice(0, 2)}...${sha256(value).slice(-2)}</pre>`;
      }

      shift = false;
      function shift_check() {
        if (event.keyCode == 16) { // 쉬프트 눌림
          if (shift === true) { // 연속 2번 눌렸다면
            // 조금 위험한 것들 실행(계산)
            try {
              set_table("계산값", math.evaluate(m));
            } catch(e) {
              set_table("계산값", e);
            }

            shift = false;
          } else {
            shift = true;
          }
        } else {
          shift = false;
        }
      }

      function click_table() {
        if (event.target.id === "table") return
        s = event.target.innerHTML;
        if (s.startsWith("<!-- ")) {
          s = s.slice(5, s.indexOf(" -->"))
        } else if (s.startsWith("<pre>") && s.endsWith("</pre>")) {
          s = s.slice(5, -6)
        }
        document.getElementById("myTextarea").value = s
        main();
      }
      
      function see_spoiler() {
        event.currentTarget.innerHTML = `<pre>${event.currentTarget.innerHTML.slice(5, event.currentTarget.innerHTML.indexOf(" -->"))}</pre>`
      }
      
      function not_see_spoiler() {
        event.currentTarget.innerHTML = `<!-- ${event.currentTarget.innerHTML.slice(5, -6)} --><pre>${event.currentTarget.innerHTML.slice(5, 7)}...${event.currentTarget.innerHTML.slice(-8)}</pre>`
      }

      function main() {
        m = document.getElementById("myTextarea").value;

        set_table("기본값", m);
        set_table("글자수", m.length !== 0 ? m.length : "");
        set_table("한영타", gksdud(m));
        set_table("영한타", dudgks(m));
        set_table("영한영타", gksdud(dudgks(m)));
        set_table("한영한타", dudgks(gksdud(m)));
        set_table("반대로", m.split("").reverse().join(""));
        set_table("첫번째글자", m[0] !== undefined ? m[0] : "");
        set_table("마지막글자", m.slice(-1));
      }
    </script>
  </head>
  
  <body id="body" onkeydown="shift_check();" onload="body_load();">
    <form>
      <textarea id="myTextarea" autofocus placeholder="입력해보세요!" oninput="main();"></textarea><br>
    </form>
    <table id="table" border="1" onclick="click_table(event);"> </table>
  </body>
</html>
